"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var swingDragOptions_1 = require("./swingDragOptions");
var SwingDragPlugIn = (function () {
    function SwingDragPlugIn(swingDragOptions) {
        this.plugInName = 'ui.swingdrag';
        this.swingDragOptions = swingDragOptions;
        if (!this.swingDragOptions) {
            this.swingDragOptions = new swingDragOptions_1.SwingDragOptions();
        }
    }
    SwingDragPlugIn.prototype.destroy = function () {
        if (!$ || !$.Widget) {
            return;
        }
        $.Widget.prototype.destroy.call(this);
        if (!this.element) {
            return;
        }
        var elementRef = $(this.element);
        elementRef.draggable('destroy');
        elementRef.removeClass('swingdrag');
        elementRef.removeClass('swingdrag-shadow');
        $(this.element).css({
            "transform": "",
        });
    };
    SwingDragPlugIn.prototype.register = function () {
        $.widget(this.plugInName, this);
    };
    SwingDragPlugIn.prototype._create = function () {
        var _this = this;
        var elementRef = $(this.element);
        elementRef.addClass('swingdrag');
        var direction = 0;
        var oldDirection = 0;
        var oldX;
        var dragging = false;
        if (!this.options.maxRotationAngleDeg || this.options.maxRotationAngleDeg <= 0) {
            this.options.maxRotationAngleDeg = this.swingDragOptions.maxRotationAngleDeg;
        }
        if (this.options.showShadow === undefined) {
            this.options.showShadow = this.swingDragOptions.showShadow;
        }
        if (!this.options.pickUpScaleFactor) {
            this.options.pickUpScaleFactor = this.swingDragOptions.pickUpScaleFactor;
        }
        elementRef.draggable({
            start: function (e) {
                dragging = true;
                if (_this.swingDragOptions.showShadow) {
                    elementRef.addClass('swingdrag-shadow');
                }
            },
            drag: function (e) {
                direction = _this.getDirection(e.clientX, oldX);
                oldX = e.clientX;
                if (oldDirection != direction) {
                    elementRef.css({
                        "transform": 'rotate(' + (_this.swingDragOptions.maxRotationAngleDeg * direction) + 'deg) scale(' + _this.swingDragOptions.pickUpScaleFactor + ')'
                    });
                    oldDirection = direction;
                }
            },
            stop: function (e) {
                elementRef.removeClass('swingdrag-shadow');
                elementRef.css({
                    "transform": "rotate(0deg) scale(1)"
                });
                oldDirection = 0;
                dragging = false;
            }
        });
    };
    SwingDragPlugIn.prototype.getDirection = function (actualX, oldX) {
        var diffX = actualX - oldX;
        if (actualX < oldX) {
            return -1;
        }
        else if (actualX > oldX) {
            return 1;
        }
        else {
            return 0;
        }
    };
    SwingDragPlugIn.prototype._setOption = function (option, value) {
        $.Widget.prototype._setOption.apply(this, arguments);
        switch (option) {
            case "maxRotationAngleDeg":
                this.swingDragOptions.maxRotationAngleDeg = value;
                break;
            case "showShadow":
                this.swingDragOptions.showShadow = value;
                break;
            case "pickUpScaleFactor":
                this.swingDragOptions.pickUpScaleFactor = value;
                break;
        }
    };
    return SwingDragPlugIn;
}());
exports.SwingDragPlugIn = SwingDragPlugIn;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDeEIsTUFBTSxDQUFDLENBQWdCLENBQUM7UUFDNUIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osTUFBTSxDQUFDLENBQW9CLENBQUM7UUFDaEMsQ0FBQztJQUNMLENBQUM7SUFZTyxvQ0FBVSxHQUFsQixVQUFtQixNQUFXLEVBQUUsS0FBVTtRQUN0QyxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztRQUVyRCxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2IsS0FBSyxxQkFBcUI7Z0JBQ3RCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxtQkFBbUIsR0FBRyxLQUFLLENBQUM7Z0JBQ2xELEtBQUssQ0FBQztZQUNWLEtBQUssWUFBWTtnQkFDYixJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztnQkFDekMsS0FBSyxDQUFDO1lBQ1YsS0FBSyxtQkFBbUI7Z0JBQ3BCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENBQUM7Z0JBQ2hELEtBQUssQ0FBQztRQUNkLENBQUM7SUFDTCxDQUFDO0lBRUwsc0JBQUM7QUFBRCxDQS9LQSxBQStLQyxJQUFBO0FBL0tZLDBDQUFlIiwiZmlsZSI6InN3aW5nRHJhZ1BsdWdJbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9ub2RlX21vZHVsZXMvQHR5cGVzL2pxdWVyeXVpL2luZGV4LmQudHNcIiAvPlxyXG5cclxuaW1wb3J0ICogYXMgalF1ZXJ5IGZyb20gJ2pxdWVyeSc7XHJcbmltcG9ydCB7IFN3aW5nRHJhZ09wdGlvbnMgfSBmcm9tICcuL3N3aW5nRHJhZ09wdGlvbnMnO1xyXG5pbXBvcnQgeyBEaXJlY3Rpb25zIH0gZnJvbSAnLi9kaXJlY3Rpb25zJztcclxuXHJcblxyXG4vKipcclxuICogVGhlIG1haW4galF1ZXJ5IFBsdWdJbiBpbXBsZW1lbnRhdGlvbiBvZiBzd2luZ2RyYWcuXHJcbiAqIFxyXG4gKiBAZXhwb3J0XHJcbiAqIEBjbGFzcyBTd2luZ0RyYWdQbHVnSW5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBTd2luZ0RyYWdQbHVnSW4ge1xyXG5cclxuICAgIHByaXZhdGUgcGx1Z0luTmFtZTogc3RyaW5nID0gJ3VpLnN3aW5nZHJhZyc7XHJcbiAgICBwcml2YXRlIG9wdGlvbnM6IGFueTtcclxuICAgIHByaXZhdGUgc3dpbmdEcmFnT3B0aW9uczogU3dpbmdEcmFnT3B0aW9ucztcclxuICAgIHByaXZhdGUgZWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBTd2luZ0RyYWdQbHVnSW4uXHJcbiAgICAgKiBAcGFyYW0ge1N3aW5nRHJhZ09wdGlvbnN9IFtzd2luZ0RyYWdPcHRpb25zXSBcclxuICAgICAqIFxyXG4gICAgICogQG1lbWJlck9mIFN3aW5nRHJhZ1BsdWdJblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3Ioc3dpbmdEcmFnT3B0aW9ucz86IFN3aW5nRHJhZ09wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLnN3aW5nRHJhZ09wdGlvbnMgPSBzd2luZ0RyYWdPcHRpb25zO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuc3dpbmdEcmFnT3B0aW9ucykge1xyXG4gICAgICAgICAgICB0aGlzLnN3aW5nRHJhZ09wdGlvbnMgPSBuZXcgU3dpbmdEcmFnT3B0aW9ucygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBEZXN0cm95cyB0aGUgcGx1Z2luIGluc3RhbmNlLlxyXG4gICAgICogXHJcbiAgICAgKiBcclxuICAgICAqIEBtZW1iZXJPZiBTd2luZ0RyYWdQbHVnSW5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKCEkIHx8ICEkLldpZGdldCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkLldpZGdldC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgZWxlbWVudFJlZiA9ICQodGhpcy5lbGVtZW50KTtcclxuICAgICAgICBlbGVtZW50UmVmLmRyYWdnYWJsZSgnZGVzdHJveScpO1xyXG5cclxuICAgICAgICBlbGVtZW50UmVmLnJlbW92ZUNsYXNzKCdzd2luZ2RyYWcnKTtcclxuICAgICAgICBlbGVtZW50UmVmLnJlbW92ZUNsYXNzKCdzd2luZ2RyYWctc2hhZG93Jyk7XHJcblxyXG4gICAgICAgICQodGhpcy5lbGVtZW50KS5jc3Moe1xyXG4gICAgICAgICAgICBcInRyYW5zZm9ybVwiOiBcIlwiLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVycyB0aGlzIGluc3RhbmNlIGFzIGEgalF1ZXJ5IFVJIHBsdWdpbi5cclxuICAgICAqIFxyXG4gICAgICogQG1lbWJlck9mIFN3aW5nRHJhZ1BsdWdJblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcmVnaXN0ZXIoKTogdm9pZCB7XHJcbiAgICAgICAgJC53aWRnZXQodGhpcy5wbHVnSW5OYW1lLCB0aGlzKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIHRoZSBwbHVnaW4uXHJcbiAgICAgKiBcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBcclxuICAgICAqIEBtZW1iZXJPZiBTd2luZ0RyYWdQbHVnSW5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfY3JlYXRlKCkge1xyXG5cclxuICAgICAgICBsZXQgZWxlbWVudFJlZiA9ICQodGhpcy5lbGVtZW50KTtcclxuXHJcbiAgICAgICAgZWxlbWVudFJlZi5hZGRDbGFzcygnc3dpbmdkcmFnJyk7XHJcblxyXG4gICAgICAgIC8vIHRoZSBtYWluIGltcGxlbWVudGF0aW9uIGxvZ2ljXHJcbiAgICAgICAgbGV0IGRpcmVjdGlvbjogRGlyZWN0aW9ucyA9IERpcmVjdGlvbnMudW5kZWZpbmVkO1xyXG4gICAgICAgIGxldCBvbGREaXJlY3Rpb246IERpcmVjdGlvbnMgPSBEaXJlY3Rpb25zLnVuZGVmaW5lZDtcclxuICAgICAgICBsZXQgb2xkWDogbnVtYmVyO1xyXG4gICAgICAgIGxldCBkcmFnZ2luZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5tYXhSb3RhdGlvbkFuZ2xlRGVnIHx8IHRoaXMub3B0aW9ucy5tYXhSb3RhdGlvbkFuZ2xlRGVnIDw9IDApIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1heFJvdGF0aW9uQW5nbGVEZWcgPSB0aGlzLnN3aW5nRHJhZ09wdGlvbnMubWF4Um90YXRpb25BbmdsZURlZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2hvd1NoYWRvdyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zaG93U2hhZG93ID0gdGhpcy5zd2luZ0RyYWdPcHRpb25zLnNob3dTaGFkb3c7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5waWNrVXBTY2FsZUZhY3Rvcikge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucGlja1VwU2NhbGVGYWN0b3IgPSB0aGlzLnN3aW5nRHJhZ09wdGlvbnMucGlja1VwU2NhbGVGYWN0b3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBlbGVtZW50UmVmLmRyYWdnYWJsZSh7XHJcblxyXG4gICAgICAgICAgICBzdGFydDogKGU6IEpRdWVyeUV2ZW50T2JqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBkcmFnZ2luZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3dpbmdEcmFnT3B0aW9ucy5zaG93U2hhZG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFJlZi5hZGRDbGFzcygnc3dpbmdkcmFnLXNoYWRvdycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgZHJhZzogKGU6IEpRdWVyeUV2ZW50T2JqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSB0aGlzLmdldERpcmVjdGlvbihlLmNsaWVudFgsIG9sZFgpO1xyXG4gICAgICAgICAgICAgICAgb2xkWCA9IGUuY2xpZW50WDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob2xkRGlyZWN0aW9uICE9IGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRSZWYuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2Zvcm1cIjogJ3JvdGF0ZSgnICsgKHRoaXMuc3dpbmdEcmFnT3B0aW9ucy5tYXhSb3RhdGlvbkFuZ2xlRGVnICogZGlyZWN0aW9uKSArICdkZWcpIHNjYWxlKCcgKyB0aGlzLnN3aW5nRHJhZ09wdGlvbnMucGlja1VwU2NhbGVGYWN0b3IgKyAnKSdcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBvbGREaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBzdG9wOiAoZTogSlF1ZXJ5RXZlbnRPYmplY3QpID0+IHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnRSZWYucmVtb3ZlQ2xhc3MoJ3N3aW5nZHJhZy1zaGFkb3cnKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnRSZWYuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICBcInRyYW5zZm9ybVwiOiBcInJvdGF0ZSgwZGVnKSBzY2FsZSgxKVwiXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIG9sZERpcmVjdGlvbiA9IERpcmVjdGlvbnMudW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxjdWxhdGVzIHRoZSBkcmFnZ2luZyBkaXJlY3Rpb24uXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBhY3R1YWxYIFxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG9sZFggXHJcbiAgICAgKiBAcmV0dXJucyB7RGlyZWN0aW9uc30gXHJcbiAgICAgKiBcclxuICAgICAqIEBtZW1iZXJPZiBTd2luZ0RyYWdQbHVnSW5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldERpcmVjdGlvbihhY3R1YWxYOiBudW1iZXIsIG9sZFg6IG51bWJlcik6IERpcmVjdGlvbnMge1xyXG5cclxuICAgICAgICBsZXQgZGlmZlggPSBhY3R1YWxYIC0gb2xkWDtcclxuICAgICAgICBpZiAoYWN0dWFsWCA8IG9sZFgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIERpcmVjdGlvbnMubGVmdDtcclxuICAgICAgICB9IGVsc2UgaWYgKGFjdHVhbFggPiBvbGRYKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBEaXJlY3Rpb25zLnJpZ2h0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBEaXJlY3Rpb25zLnVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0cyBhbiBvcHRpb24uXHJcbiAgICAgKiBcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBAcGFyYW0geyp9IG9wdGlvbiBcclxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgXHJcbiAgICAgKiBcclxuICAgICAqIEBtZW1iZXJPZiBTd2luZ0RyYWdQbHVnSW5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfc2V0T3B0aW9uKG9wdGlvbjogYW55LCB2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgJC5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChvcHRpb24pIHtcclxuICAgICAgICAgICAgY2FzZSBcIm1heFJvdGF0aW9uQW5nbGVEZWdcIjpcclxuICAgICAgICAgICAgICAgIHRoaXMuc3dpbmdEcmFnT3B0aW9ucy5tYXhSb3RhdGlvbkFuZ2xlRGVnID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcInNob3dTaGFkb3dcIjpcclxuICAgICAgICAgICAgICAgIHRoaXMuc3dpbmdEcmFnT3B0aW9ucy5zaG93U2hhZG93ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcInBpY2tVcFNjYWxlRmFjdG9yXCI6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN3aW5nRHJhZ09wdGlvbnMucGlja1VwU2NhbGVGYWN0b3IgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0iXX0=
